{% extends "base.html" %}
{% block content %}
<h2>Admin — Payments</h2>
<table class="table">
  <thead><tr>
    <th>Created</th><th>Ticket</th><th>Method</th><th>Status</th><th>Proof</th><th>Actions</th>
  </tr></thead>
  <tbody>
  {% for r in records %}
    <tr>
      <td>{{ r.created_at or '' }}</td>
      <td>{{ r.ticket_id }}</td>
      <td>{{ r.payment_info.method if r.payment_info else '' }}</td>
      <td>{{ r.status or ('paid' if r.paid else 'pending') }}</td>
      <td>
        {% if r.payment_info and r.payment_info.proof_url %}
          <a href="{{ r.payment_info.proof_url }}" target="_blank">View</a>
        {% endif %}
      </td>
      <td>
        {% if (r.status or '') == 'pending_verification' %}
          <form style="display:inline" method="post" action="{{ url_for('admin_verify', ticket=r.ticket_id, action='approve') }}">
            <button class="btn">Approve</button>
          </form>
          <form style="display:inline" method="post" action="{{ url_for('admin_verify', ticket=r.ticket_id, action='reject') }}">
            <button class="btn danger">Reject</button>
          </form>
        {% else %} — {% endif %}
        
        <a class="btn small" href="{{ url_for('view_card', ticket_id=r.ticket_id) }}" target="_blank">View Card</a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}