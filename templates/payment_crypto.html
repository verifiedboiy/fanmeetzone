{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Crypto Payment</h2>
  <p>Please choose your network, send the payment, then upload a screenshot of the successful transaction.</p>

  <!-- chooser -->
  <div style="display:flex; gap:8px; flex-wrap:wrap; margin:12px 0;">
    <button type="button" class="btn outline" data-coin="BTC">Bitcoin (BTC)</button>
    <button type="button" class="btn outline" data-coin="ETH">Ethereum (ETH)</button>
    <button type="button" class="btn outline" data-coin="SOL">Solana (SOL)</button>
  </div>

  <!-- address panel -->
  <div id="addrBox" style="display:none; background:#0f1a2b; border:1px solid #2a3b57; border-radius:8px; padding:12px; margin:10px 0;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
      <div>
        <div style="opacity:.8; font-size:.9rem;">Selected Network</div>
        <strong id="coinLabel">—</strong>
      </div>
      <div style="flex:1;"></div>
      <div>
        <div style="opacity:.8; font-size:.9rem;">Wallet Address</div>
        <code id="walletAddr" style="word-break:break-all;"></code>
      </div>
      <button type="button" id="copyBtn" class="btn small" style="margin-left:auto;">Copy</button>
    </div>
    <p style="margin:10px 0 0; font-size:.95rem; opacity:.85;">
      ⚠️ Double-check the address before sending. Only send the correct asset on the selected network.
    </p>
  </div>

  <!-- proof upload -->
  <form id="proofForm" action="{{ url_for('payment_crypto') }}" method="POST" enctype="multipart/form-data" style="margin-top:12px;">
    <input type="hidden" name="coin" id="coinInput">
    <input type="hidden" name="address" id="addrInput">

    <label>Upload transaction screenshot (required)</label><br>
    <input type="file" name="crypto_proof" accept="image/*" required style="margin:6px 0 12px;">
    <button class="btn" type="submit" disabled id="submitBtn">Submit for Review</button>
  </form>

  <p style="margin-top:10px; font-size:.95rem; opacity:.85;">
    After you submit, your payment will show as <strong>pending review</strong>. Our team will verify it shortly.
  </p>
</section>

<script>
  // hard-coded addresses (provided by you)
  const ADDRS = {
    BTC: "bc1q0x93ysaw9yf2gzsj6hfxa73yvcfmqftcqywrxs",
    ETH: "0xf78abb5f48603ca685ebfaa59c8e4c0f19c6a826",
    SOL: "XFPDNN9J9tzhESkWU88fVZX5QsQdda6W9x7yefhRXdR"
  };

  const chooserBtns = document.querySelectorAll('button[data-coin]');
  const addrBox     = document.getElementById('addrBox');
  const coinLabel   = document.getElementById('coinLabel');
  const walletAddr  = document.getElementById('walletAddr');
  const copyBtn     = document.getElementById('copyBtn');
  const coinInput   = document.getElementById('coinInput');
  const addrInput   = document.getElementById('addrInput');
  const submitBtn   = document.getElementById('submitBtn');

  chooserBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const coin = btn.dataset.coin;
      const addr = ADDRS[coin];

      // visual: mark selected
      chooserBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // fill UI + hidden inputs
      coinLabel.textContent = coin === 'BTC' ? 'Bitcoin (BTC)'
                           : coin === 'ETH' ? 'Ethereum (ETH)'
                           : 'Solana (SOL)';
      walletAddr.textContent = addr;
      coinInput.value = coin;
      addrInput.value = addr;

      addrBox.style.display = 'block';
      submitBtn.disabled = false;
    });
  });

  copyBtn.addEventListener('click', async () => {
    if (!walletAddr.textContent) return;
    try {
      await navigator.clipboard.writeText(walletAddr.textContent);
      copyBtn.textContent = 'Copied!';
      setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
    } catch (e) {
      alert('Copy failed. Please long-press and copy the address.');
    }
  });
</script>
{% endblock %}